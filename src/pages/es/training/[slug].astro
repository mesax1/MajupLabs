---
import { getCollection, render } from 'astro:content';
import PageLayout from '@/layouts/Base.astro';
import { Icon } from 'astro-icon/components';
import type { CollectionEntry } from 'astro:content';
import { trainingPricing } from '@/data/pricing';

export async function getStaticPaths() {
  const courses = await getCollection('training', ({ data }: CollectionEntry<'training'>) => {
    return data.draft !== true && data.lang === 'es';
  });
  return courses.map((course: CollectionEntry<'training'>) => ({
    params: { slug: course.data.slug },
    props: { course },
  }));
}

interface Props {
  course: CollectionEntry<'training'>;
}

const { course } = Astro.props;
const { Content } = await render(course);

const meta = {
  title: `${course.data.title} | Capacitación MajupLabs`,
  description: course.data.shortDescription,
};

// Get gradient classes
const gradientClasses = course.data.gradient || 'from-accent-one to-accent-two';

// Get price from centralized pricing config
const pricingKey = course.data.pricingKey as keyof typeof trainingPricing;
const pricing = trainingPricing[pricingKey];
const priceLabel = pricing && 'label' in pricing ? pricing.label.es : null;
---

<PageLayout meta={meta}>
  <!-- Hero Section -->
  <div class="relative mb-12">
    <!-- Background gradient -->
    <div class="absolute inset-0 -z-10 overflow-hidden">
      <div class={`absolute top-0 left-1/4 w-96 h-96 bg-gradient-to-br ${gradientClasses} opacity-20 rounded-full blur-3xl`}></div>
      <div class="absolute top-20 right-1/4 w-80 h-80 bg-gradient-to-bl from-purple-400/15 to-blue-400/15 rounded-full blur-3xl"></div>
    </div>

    <nav class="mb-8">
      <a href="/es/training/" class="inline-flex items-center gap-2 text-light hover:text-accent-base transition-colors">
        <Icon name="solar:arrow-left-linear" class="w-4 h-4" />
        Volver a Capacitación
      </a>
    </nav>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
      <!-- Icon -->
      <div class="flex-shrink-0">
        <div class={`w-24 h-24 bg-gradient-to-br ${gradientClasses} rounded-3xl flex items-center justify-center shadow-2xl`}>
          {course.data.icon && (
            <Icon name={course.data.icon} class="w-12 h-12 text-white" />
          )}
        </div>
      </div>

      <!-- Title and description -->
      <div class="flex-1">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 bg-gradient-to-r from-accent-one to-accent-two bg-clip-text text-transparent">
          {course.data.title}
        </h1>
        <p class="text-lg sm:text-xl text-light leading-relaxed mb-6">
          {course.data.shortDescription}
        </p>

        <!-- Quick info badges -->
        <div class="flex flex-wrap gap-3">
          <span class="inline-flex items-center gap-2 px-4 py-2 bg-special-lighter rounded-full text-sm font-medium">
            <Icon name="solar:clock-circle-bold" class="w-4 h-4 text-accent-one" />
            {course.data.duration}
          </span>
          {course.data.format.map((f) => (
            <span class="inline-flex items-center gap-2 px-4 py-2 bg-special-lighter rounded-full text-sm font-medium">
              <Icon name="solar:monitor-bold" class="w-4 h-4 text-accent-two" />
              {f}
            </span>
          ))}
          {priceLabel && (
            <span class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent-one/20 to-accent-two/20 rounded-full text-sm font-semibold text-accent-base border border-accent-one/30">
              <Icon name="solar:tag-bold" class="w-4 h-4" />
              {priceLabel}
            </span>
          )}
        </div>
      </div>
    </div>
  </div>

  <!-- CTA Section -->
  <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
    <a 
      href="https://calendar.app.google/VALDzjK7GqCTvYz56" 
      target="_blank" 
      rel="noopener" 
      class="inline-flex items-center justify-center min-h-[3rem] px-8 py-3 rounded-lg shadow-lg hover:brightness-110 transition-all bg-gradient-to-r from-accent-one to-accent-two text-bgColor font-semibold text-base sm:text-lg"
    >
      Solicitar Información
    </a>
    <a 
      href="/es/training/" 
      class="inline-flex items-center justify-center min-h-[3rem] px-8 py-3 rounded-lg border-2 border-special-light hover:border-accent-base/50 transition-all font-semibold"
    >
      Ver Otros Programas
    </a>
  </div>

  <!-- Two column layout -->
  <div class="grid lg:grid-cols-3 gap-8 mb-12">
    <!-- Sidebar with info cards -->
    <div class="lg:col-span-1 space-y-6">
      <!-- Target Audience -->
      <div class="bg-special-lighter rounded-2xl p-6 border border-special-light">
        <h3 class="text-lg font-bold text-accent-base mb-4 flex items-center gap-2">
          <Icon name="solar:users-group-rounded-bold" class="w-5 h-5" />
          ¿Para quién es?
        </h3>
        <ul class="space-y-3">
          {course.data.targetAudience.map((audience) => (
            <li class="flex items-start gap-3 text-sm">
              <Icon name="solar:check-circle-bold" class="w-5 h-5 text-accent-two flex-shrink-0 mt-0.5" />
              <span>{audience}</span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Outcomes -->
      <div class="bg-special-lighter rounded-2xl p-6 border border-special-light">
        <h3 class="text-lg font-bold text-accent-base mb-4 flex items-center gap-2">
          <Icon name="solar:medal-ribbons-star-bold" class="w-5 h-5" />
          Lo que Lograrás
        </h3>
        <ul class="space-y-3">
          {course.data.outcomes.map((outcome) => (
            <li class="flex items-start gap-3 text-sm">
              <Icon name="solar:star-bold" class="w-5 h-5 text-accent-one flex-shrink-0 mt-0.5" />
              <span>{outcome}</span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Modules -->
      {course.data.modules && course.data.modules.length > 0 && (
        <div class="bg-special-lighter rounded-2xl p-6 border border-special-light">
          <h3 class="text-lg font-bold text-accent-base mb-4 flex items-center gap-2">
            <Icon name="solar:notebook-bookmark-bold" class="w-5 h-5" />
            Contenido del Programa
          </h3>
          <div class="space-y-4">
            {course.data.modules.map((module, idx) => (
              <div class="border-l-2 border-accent-one/50 pl-4">
                <h4 class="font-semibold text-sm mb-2">
                  <span class="text-accent-two">Módulo {idx + 1}:</span> {module.title}
                </h4>
                <ul class="space-y-1">
                  {module.topics.map((topic) => (
                    <li class="text-xs text-light flex items-start gap-2">
                      <span class="text-accent-one">•</span>
                      {topic}
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>

    <!-- Main content -->
    <div class="lg:col-span-2">
      <article class="prose prose-lg prose-citrus max-w-none prose-headings:font-semibold prose-headings:text-accent-base prose-headings:before:text-accent-two">
        <Content />
      </article>
    </div>
  </div>

  <!-- Bottom CTA -->
  <section class="text-center bg-gradient-to-br from-accent-one/10 to-accent-two/10 rounded-2xl p-8 md:p-12">
    <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-accent-base">
      ¿Listo para Transformar tu Equipo?
    </h2>
    <p class="text-lg text-light mb-8 max-w-2xl mx-auto">
      Agenda una llamada de consultoría gratuita para diseñar este programa a la medida de tu organización.
    </p>
    <div class="flex flex-col sm:flex-row justify-center gap-4">
      <a 
        href="https://calendar.app.google/VALDzjK7GqCTvYz56" 
        target="_blank" 
        rel="noopener" 
        class="inline-flex items-center justify-center min-h-[3rem] px-8 py-3 rounded-lg shadow-lg hover:brightness-110 transition-all bg-gradient-to-r from-accent-one to-accent-two text-bgColor font-semibold text-base sm:text-lg"
      >
        Agenda tu Consultoría Gratuita
      </a>
      <a 
        href="/es/training/" 
        class="inline-flex items-center justify-center min-h-[3rem] px-8 py-3 rounded-lg shadow-lg bg-special-lighter hover:brightness-110 hover:bg-special-lightest transition-all"
      >
        <span class="bg-clip-text text-transparent font-semibold bg-gradient-to-r from-accent-one to-accent-two text-base sm:text-lg">
          Ver Todos los Programas
        </span>
      </a>
    </div>
  </section>
</PageLayout>






